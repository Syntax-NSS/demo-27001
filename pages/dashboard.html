<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Gesti贸n de Calidad</title>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/components.css">
    <style>
        body {
            background-color: var(--color-background);
        }

        .main-content {
            margin-left: 90px;
            padding: 0;
        }

        .page-title {
            padding: 20px 40px;
            background-color: var(--color-background);
        }

        .page-title h1 {
            font-size: 32px;
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .dashboard-grid {
            padding: 30px 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .card-icon.blue {
            background-color: var(--color-info-bg);
            color: var(--color-primary);
        }

        .card-icon.green {
            background-color: var(--color-success-bg);
            color: var(--color-success);
        }

        .card-icon.orange {
            background-color: var(--color-warning-bg);
            color: var(--color-warning);
        }

        .card-icon.red {
            background-color: var(--color-danger-bg);
            color: var(--color-danger);
        }

        .card-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--color-border-light);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-muted);
            margin-top: 4px;
        }

        .dashboard-card {
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 60px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div id="header"></div>

        <!-- Breadcrumb -->
        <div id="breadcrumb"></div>

        <!-- Page Title -->
        <div class="page-title">
            <h1>Panel de Control ISO 27001 / ISO 20000-1</h1>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- Las tarjetas se generar谩n din谩micamente con JavaScript -->
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/storage.js"></script>
    <script src="../js/components.js"></script>
    <script>
        // Renderizar componentes
        document.getElementById('sidebar').innerHTML = renderSidebar('dashboard');
        document.getElementById('header').innerHTML = renderHeader();
        document.getElementById('breadcrumb').innerHTML = renderBreadcrumb([
            { icon: '', text: 'Inicio', link: '../index.html' },
            { text: 'Dashboard' }
        ]);

        // Cargar datos del dashboard
        function loadDashboard() {
            const stats = storage.getDashboardStats();
            const dashboardGrid = document.getElementById('dashboardGrid');

            const cards = [
                {
                    icon: '',
                    iconClass: 'blue',
                    title: 'Plan de Acciones Correctivas (PAC)',
                    description: 'Seguimiento y gesti贸n de acciones correctivas derivadas de no conformidades y auditor铆as',
                    badge: { text: `${stats.pac.pendientes} Pendientes`, type: 'warning' },
                    stats: [
                        { value: stats.pac.activas, label: 'Activas' },
                        { value: stats.pac.cerradas, label: 'Cerradas' },
                        { value: '85%', label: 'Eficacia' }
                    ],
                    link: 'pac.html'
                },
                {
                    icon: '',
                    iconClass: 'orange',
                    title: 'Indicadores de Proceso',
                    description: 'Monitorizaci贸n de KPIs y m茅tricas de rendimiento de los procesos del SGC',
                    badge: { text: `${stats.indicadores.enAlerta} Alertas`, type: 'warning' },
                    stats: [
                        { value: stats.indicadores.total, label: 'Indicadores' },
                        { value: stats.indicadores.enMeta, label: 'En meta' },
                        { value: `${Math.round((stats.indicadores.enMeta / stats.indicadores.total) * 100)}%`, label: 'Cumplimiento' }
                    ],
                    link: 'indicadores.html'
                },
                {
                    icon: '锔',
                    iconClass: 'red',
                    title: 'Quejas y Reclamaciones',
                    description: 'Gesti贸n de quejas y reclamaciones de clientes sobre servicios prestados',
                    badge: { text: `${stats.quejas.abiertas} Abiertas`, type: 'danger' },
                    stats: [
                        { value: stats.quejas.abiertas, label: 'Abiertas' },
                        { value: stats.quejas.resueltas, label: 'Resueltas' },
                        { value: '2.5d', label: 'Tiempo medio' }
                    ],
                    link: 'quejas.html'
                },
                {
                    icon: '',
                    iconClass: 'orange',
                    title: 'Pruebas de Continuidad',
                    description: 'Seguimiento y validaci贸n de pruebas del plan de continuidad de negocio anual',
                    badge: { text: `${stats.pruebas.planificadas} Planificadas`, type: 'info' },
                    stats: [
                        { value: stats.pruebas.total, label: 'Total anual' },
                        { value: stats.pruebas.completadas, label: 'Realizadas' },
                        { value: `${Math.round((stats.pruebas.completadas / stats.pruebas.total) * 100)}%`, label: 'Completado' }
                    ],
                    link: 'pruebas-continuidad.html'
                }
            ];

            dashboardGrid.innerHTML = cards.map(card => `
                <div class="card dashboard-card" onclick="navigateTo('${card.link}')">
                    <div class="card-header">
                        <div class="card-icon ${card.iconClass}">
                            ${card.icon}
                        </div>
                        <span class="badge badge-${card.badge.type}">${card.badge.text}</span>
                    </div>
                    <div class="card-title">${card.title}</div>
                    <div class="card-description">${card.description}</div>
                    <div class="card-stats">
                        ${card.stats.map(stat => `
                            <div class="stat-item">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Inicializar dashboard
        loadDashboard();
    </script>
</body>
</html>
